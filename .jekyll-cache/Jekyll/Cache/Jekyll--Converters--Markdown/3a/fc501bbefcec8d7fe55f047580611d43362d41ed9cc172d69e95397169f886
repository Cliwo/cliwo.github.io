I"¸B<h2 id="threejs---rimlight-ì™€-phong-shading-êµ¬í˜„-glsl-2">ThreeJS - RimLight ì™€ Phong Shading êµ¬í˜„ (GLSL) #2</h2>

<p>ë‘ ë²ˆì§¸ í¬ìŠ¤íŒ…ì…ë‹ˆë‹¤. RimLight êµ¬í˜„ ë¶€ë¶„ì„ ë‹¤ë£¹ë‹ˆë‹¤.</p>

<p><strong>ëª©ì°¨ :</strong></p>
<ol>
  <li>Gouraud vs Phong Shading (#1)</li>
  <li>Phong Shading êµ¬í˜„ (#1)
    <ol>
      <li>Three.js - glsl Shaderì—ì„œ Light ì‚¬ìš©í•˜ê¸°</li>
      <li>Phong Shading êµ¬í˜„</li>
    </ol>
  </li>
  <li>Rim Light êµ¬í˜„ (#2)</li>
</ol>

<h3 id="3-rim-light-êµ¬í˜„">3. Rim Light êµ¬í˜„</h3>
<p>ì°¸ê³  :<br />
<a href="https://www.roxlu.com/2014/037/opengl-rim-shader">https://www.roxlu.com/2014/037/opengl-rim-shader</a></p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">varying</span> <span class="kt">vec3</span> <span class="n">WorldPos</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">ViewPos</span><span class="p">;</span>

<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInWorld</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInView</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">WorldPos</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">modelMatrix</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">));</span>
    <span class="n">ViewPos</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">viewMatrix</span> <span class="o">*</span> <span class="n">modelMatrix</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">));</span>

    <span class="n">NormalInWorld</span> <span class="o">=</span> <span class="kt">mat3</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">)))</span> <span class="o">*</span> <span class="n">normal</span><span class="p">;</span>
    <span class="n">NormalInView</span> <span class="o">=</span> <span class="n">normalMatrix</span> <span class="o">*</span> <span class="n">normal</span><span class="p">;</span> 
    <span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">projectionMatrix</span> <span class="o">*</span> <span class="n">viewMatrix</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">WorldPos</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<center>(vertex shader)</center>
<p><br /></p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if NUM_DIR_LIGHTS &gt; 0
</span>    <span class="k">struct</span> <span class="n">DirectionalLight</span> <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">direction</span><span class="p">;</span>
        <span class="kt">vec3</span> <span class="n">color</span><span class="p">;</span>
     <span class="p">};</span>
     <span class="k">uniform</span> <span class="n">DirectionalLight</span> <span class="n">directionalLights</span><span class="p">[</span> <span class="n">NUM_DIR_LIGHTS</span> <span class="p">];</span>
<span class="cp">#endif
</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">WorldPos</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">ViewPos</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInView</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInWorld</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// ambient</span>
    <span class="c1">// vec3 ambient = light.ambient * material.ambient;</span>
  	 
    <span class="kt">vec3</span> <span class="n">normInView</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">NormalInView</span><span class="p">);</span> <span class="c1">// in view space</span>
    <span class="kt">vec3</span> <span class="n">viewDirInViewSpace</span> <span class="o">=</span> <span class="o">-</span><span class="n">normalize</span><span class="p">(</span><span class="n">ViewPos</span><span class="p">);</span>
    <span class="kt">vec3</span> <span class="n">viewDirInWorldSpace</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cameraPosition</span> <span class="o">-</span> <span class="n">WorldPos</span><span class="p">);</span>

    <span class="c1">// diffuse</span>
    <span class="kt">vec3</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_DIR_LIGHTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">lightDir</span> <span class="o">=</span> <span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">nDotL</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normInView</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">diffuse</span> <span class="o">+=</span> <span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span> <span class="o">*</span> <span class="p">(</span><span class="n">nDotL</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// specular</span>
    <span class="kt">vec3</span> <span class="n">specular</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_DIR_LIGHTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">reflectDir</span> <span class="o">=</span> <span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">,</span> <span class="n">normInView</span><span class="p">);</span> 
        <span class="kt">float</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDirInViewSpace</span><span class="p">,</span> <span class="n">reflectDir</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span> <span class="mi">50</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">specular</span> <span class="o">+=</span> <span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span> <span class="o">*</span> <span class="n">spec</span><span class="p">;</span>  
    <span class="p">}</span>
   
    <span class="c1">// Rim Light</span>
    <span class="kt">float</span> <span class="n">vDn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDirInViewSpace</span><span class="p">,</span> <span class="n">normInView</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="kt">vec3</span> <span class="n">rim</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">vDn</span><span class="p">));</span>

    <span class="nb">gl_FragColor</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span> <span class="o">+</span> <span class="n">rim</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span> 
</code></pre></div></div>
<center>(fragment shader)</center>
<p><br /></p>

<p><strong>Fragment Shader</strong></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Rim Light</span>
<span class="kt">float</span> <span class="n">vDn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDirInViewSpace</span><span class="p">,</span> <span class="n">normInView</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="kt">vec3</span> <span class="n">rim</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">vDn</span><span class="p">));</span>

<span class="nb">gl_FragColor</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span> <span class="o">+</span> <span class="n">rim</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></div>
<center>(rim light)</center>
<p><br /></p>

<p>rim lightëŠ” <strong>fresnel ë°©ì •ì‹</strong>ì— ì˜í•´ì„œ ì„¤ëª…ë˜ê³ , ë°±ë¼ì´íŠ¸ê°€ ê°•í•  ë•Œ ë¬¼ì²´ì˜ í…Œë‘ë¦¬ ë¶€ë¶„ì— ê°•í•œ ë°˜ì‚¬ê°€ ì¼ì–´ë‚˜ëŠ” í˜„ìƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. <strong>ë°±ë¼ì´íŠ¸ê°€ ê°•í•´ì•¼</strong> ì˜ ë³´ì—¬ì„œ Sceneì— back lightë¥¼ ì¶”ê°€í•˜ê³  intensityë¥¼ ì¶©ë¶„íˆ ì£¼ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>

<h4 id="fresnel-ë°©ì •ì‹">Fresnel ë°©ì •ì‹</h4>
<p>ì½”ë“œë¥¼ ë³´ê¸°ì „ì— í”„ë ˆë„¬ ë°©ì •ì‹ì„ ì§šê³  ë„˜ì–´ê°‘ì‹œë‹¤. í”„ë ˆë„¬ ë°©ì •ì‹ì€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ë¹›ì´ ë§¤ì§ˆì˜ ê²½ê³„ì— ì…ì‚¬í•  ë•Œ êµ´ì ˆ(íˆ¬ê³¼), ë°˜ì‚¬ëŸ‰ì„ ì„¤ëª…í•˜ëŠ” ë°©ì •ì‹ ì…ë‹ˆë‹¤.   ì—¬ê¸°ì„œ ì…ì‚¬ê°ì— ë”°ë¥¸ êµ´ì ˆê°, ì „ë°˜ì‚¬ ë“±ì„ ì„¤ëª…í•˜ëŠ” ë²•ì¹™ì´ Snellì˜ êµ´ì ˆ ë²•ì¹™ (Snell's law) ê°€ ìˆìŠµë‹ˆë‹¤. (í”„ë ˆë„¬ ë°©ì •ì‹ì˜ ì¼ë¶€)  
</code></pre></div></div>

<p><img src="/assets/images/ThreeJS/2021-01-21-RimLightDev/07.png" alt="07" /></p>
<center>(Snell's law)</center>
<p><br /></p>

<p><img src="/assets/images/ThreeJS/2021-01-21-RimLightDev/06.png" alt="06" /></p>
<center>(Snell's law)</center>
<p><br /></p>

<p>n1ê³¼ n2ëŠ” ì£¼ì–´ì§€ëŠ” ìƒìˆ˜ (êµ´ì ˆë¥ ) ì´ê³  ì…ì‚¬ê°ì´ ì»¤ì§ˆìˆ˜ë¡ êµ´ì ˆê°ë„ ì»¤ì§€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë¹„ë¡€í•˜ë‹ˆê¹Œìš”)<br />
ì—¬ê¸°ì„œ êµ´ì ˆê°ì´ ì»¤ì €ì„œ 90ë„ë¥¼ ì´ë£¨ê²Œ ë˜ë©´ ì´ í›„, ë” ì´ìƒ êµ´ì ˆì€ ì¼ì–´ë‚˜ì§€ ì•Šê³  ë°˜ì‚¬ë§Œ ì¼ì–´ë‚©ë‹ˆë‹¤. ì¦‰ ì…ì‚¬í•˜ëŠ” ëª¨ë“  ë¹›ì´ ë§¤ì§ˆ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ì§€ ì•Šê³  ë‹¤ ë°˜ì‚¬ëœë‹¤ëŠ” ê²ƒì´ì£ .</p>

<p>ì´ê±¸ ëˆˆì˜ ì…ì¥ì—ì„œ ìƒê°í•˜ë©´, <strong>í‘œë©´ê³¼ ë¹„ìŠ¤ë“¬í•˜ê²Œ ë°”ë¼ë³´ë©´, ì…ì‚¬í•˜ëŠ” ë¹›ì´ ë¬¼ì²´ì— í¡ìˆ˜ë˜ì§€ ì•Šê³  ì£„ë‹¤ ëˆˆìœ¼ë¡œ ë°˜ì‚¬</strong>ëœë‹¤ëŠ” ë§ì´ ë©ë‹ˆë‹¤. 
ê·¸ë˜ì„œ <strong>ë¬¼ì²´ê°€ ë°ê²Œ ë³´ì´ê²Œ ë˜ì£ </strong>.</p>

<p>ì—¬ê¸°ì„œ â€˜ë¹„ìŠ¤ë“¬í•˜ê²Œâ€™ëŠ” ê²°êµ­ í‘œë©´ì˜ ë²•ì„  ë²¡í„°ì™€ ê±°ì˜ 90ë„ë¥¼ ì´ë£¨ê²Œ ë³¸ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ì¦‰, ë¦¼ë¼ì´íŠ¸ê°€ ë°œìƒí•˜ëŠ” ìœ„ì¹˜ëŠ” ì¹´ë©”ë¼ì™€ normalì´ ê±°ì˜ 90ë„ë¥¼ ì´ë£¨ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.
</code></pre></div></div>

<p>ë”°ë¼ì„œ viewDirì™€ normalì— ì ì ˆí•œ ì—°ì‚°ì„ í•´ì„œ ë°ê²Œ í•´ì¤„ ê³³ì„ ì°¾ìœ¼ë©´ ë©ë‹ˆë‹¤.</p>

<p>ë‹¤ì‹œ ì½”ë“œë¡œ ëŒì•„ê°€ì„œ</p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Rim Light</span>
<span class="kt">float</span> <span class="n">vDn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDirInViewSpace</span><span class="p">,</span> <span class="n">normInView</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="kt">vec3</span> <span class="n">rim</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">vDn</span><span class="p">));</span>

<span class="nb">gl_FragColor</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span> <span class="o">+</span> <span class="n">rim</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></div>
<center>(rim light)</center>
<p><br /></p>

<p>vDnì€ viewDirê³¼ normalì´ ì–¼ë§ˆë‚˜ 90ë„ì— ê°€ê¹Œìš´ ê°ì„ ì´ë£¨ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.<br />
smoothstepë¶€ë¶„ì€ trickì— ê°€ê¹ìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/images/ThreeJS/2021-01-21-RimLightDev/08.png" alt="08" /></p>
<center>(ì œëŒ€ë¡œ ëœ Fresnel)</center>
<p><br /></p>

<p>ì œëŒ€ë¡œ í•˜ë ¤ë©´ ìœ„ì˜ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ(ì ì„ ì´ Reflectionì…ë‹ˆë‹¤.) 90ë„ì— ê°€ê¹Œìš°ë©´ ê¸‰ê²©í•˜ê²Œ ìƒìŠ¹ì‹œì¼œì•¼ í•˜ì§€ë§Œ <strong>ë¹„ìš©ë„ ë¹„ì‹¸ê³ </strong>, ì •í™•íˆ ë¬˜ì‚¬í•˜ë ¤ë©´ <strong>ë§¤ì§ˆë§ˆë‹¤ í•¨ìˆ˜ê°€ ë‹¬ë¼ì ¸ì•¼</strong>í•´ì„œ (êµ´ì ˆìœ¨ì´ ë‹¤ë¥´ë¯€ë¡œ) smoothstepìœ¼ë¡œ ì ë‹¹íˆ ì¡°ì ˆí•©ë‹ˆë‹¤.</p>

<p>ë”°ë¼ì„œ ë‹¨ 2ì¤„ ì•ˆì— Rim Light êµ¬í˜„ì´ ëë‚˜ê²Œ ë©ë‹ˆë‹¤.</p>

:ET