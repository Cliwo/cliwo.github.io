I"µT<h2 id="threejs---rimlight-ì™€-phong-shading-êµ¬í˜„-glsl-1">ThreeJS - RimLight ì™€ Phong Shading êµ¬í˜„ (GLSL) #1</h2>

<p>í™€ë¦¬ì”»..</p>

<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì€ glslë¡œ ì§ì ‘ RimLightë¥¼ êµ¬í˜„í•˜ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤.
RimLightì— ì•ì„œì„œ Light êµ¬í˜„ì„ ìœ„í•´ Phong Shadingë„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
ì˜¤ëœë§Œì— í•˜ë ¤í•˜ë‹ˆê¹Œ ë¹¡ì„¸ë„¤ìš” ã…‹ã…‹ ã…œã…œ</p>

<p>1,2ëŠ” ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¨ê³ , 3ì€ ë‹¤ìŒ í¬ìŠ¤íŒ… (#2ì—ì„œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.)</p>

<p><strong>ëª©ì°¨ :</strong></p>
<ol>
  <li>Gouraud vs Phong Shading (#1)</li>
  <li>Phong Shading êµ¬í˜„ (#1)
    <ol>
      <li>Three.js - glsl Shaderì—ì„œ Light ì‚¬ìš©í•˜ê¸°</li>
      <li>Phong Shading êµ¬í˜„</li>
    </ol>
  </li>
  <li>Rim Light êµ¬í˜„ (#2)</li>
</ol>

<h3 id="1-gouraud-shading-vs-phong-shading">1. Gouraud Shading vs Phong Shading</h3>

<p>ì°¸ê³  :<br />
<a href="https://en.wikipedia.org/wiki/Gouraud_shading">https://en.wikipedia.org/wiki/Gouraud_shading</a><br />
<a href="https://en.wikipedia.org/wiki/Phong_shading">https://en.wikipedia.org/wiki/Phong_shading</a><br />
ì´ ë‚´ìš©ì€ Wiki ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. ìš°ì„  ê°€ì¥ í° ì°¨ì´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Lighting ì—°ì‚°ì„ Vertex ë‹¨ìœ„ë¡œ í•´ì„œ interpolation í•˜ëŠ”ê°€ vs
Fragment(Pixel) ë‹¨ìœ„ë¡œ í•˜ëŠ”ê°€
</code></pre></div></div>

<p>Gouraud Shadingì´ Vertex ë‹¨ìœ„ë¡œ Lightingì„ ê³„ì‚° í›„ ì„ í˜• ë³´ê°„ìœ¼ë¡œ Vertex ë‚´ë¶€ì˜ pixelì˜ ìƒ‰ì„ ì±„ìš°ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>

<p><img src="/assets/images/ThreeJS/2021-01-21-RimLightDev/01.png" alt="01" /></p>
<center>(Gouraud Shading ê²°ê³¼)</center>
<p><br /></p>

<p>ì´ ë°©ì‹ì€ Meshê°€ ì¶©ë¶„íˆ Fineí•˜ì§€ ì•Šìœ¼ë©´ í•˜ì´ë¼ì´íŠ¸ê°€ ë­‰ê°œì ¸ì„œ ë³´ì´ê²Œ ëœë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.</p>

<p>Phong Shadingì´ ì—¬ê¸°ì„œ Lighting ê³„ì‚°ì„ Fragment Shaderë¡œ ì˜®ê²¨ì„œ, Pixelë§ˆë‹¤ ë”°ë¡œ í•´ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>

<p><img src="/assets/images/ThreeJS/2021-01-21-RimLightDev/02.png" alt="01" /></p>
<center>(Phong Shading ê²°ê³¼)</center>
<p><br /></p>

<p>í•˜ì´ë¼ì´íŠ¸(Specular) ë¶€ë¶„ì´ í›¨ì”¬ ìì—°ìŠ¤ëŸ¬ìš´ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h3 id="2phong-shading-êµ¬í˜„">2.Phong Shading êµ¬í˜„</h3>

<p>Three.jsì—ì„œ Phong Shading êµ¬í˜„í•˜ë©´ì„œ 2ë²ˆì˜ ê³ ë¹„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.<br />
ì²«ë²ˆì§¸ëŠ” Sceneì— Addí•œ <strong>Lightë¥¼ glslì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒ</strong>ì´ì—ˆìŠµë‹ˆë‹¤. ê³µì‹ ë¬¸ì„œë„ ì œëŒ€ë¡œ ëœê²Œ ì—†ê³  stackoverflow ë‹µë³€ë“¤ë„ ë‹¤ ì˜¤ë˜ëœ ê²ƒë“¤ì´ë”ë¼êµ¬ìš” ã…œã…œ<br />
ì—¬ê¸°ì„œ ì •ë¦¬í•´ë†“ì€ ë‚´ìš©ìœ¼ë¡œ ë‹¤ë¥¸ ë¶„ë“¤ì€ ì‚½ì§ˆí•˜ì§€ ì•Šìœ¼ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤ ã…œ</p>

<p>ë‘ë²ˆì§¸ëŠ” Phong Shadingì„ êµ¬í˜„í•˜ëŠ” ê²ƒì´ì—ˆëŠ”ë° ì´ê²ƒë„ Three.jsì—ì„œ ì œê³µí•˜ëŠ” <strong>default uniformì´ ì–´ë–¤ spaceìƒì˜ vector</strong>ì¸ì§€ ì •ë³´ê°€ ì—†ì–´ì„œ í•´ë§¸ìŠµë‹ˆë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    vec3 lightDir; //world space ì¸ê°€? view space ì¸ê°€?
</code></pre></div></div>
<p>ì´ëŸ°ê²Œ ìˆìœ¼ë©´ ì´ê²Œ View Space ìƒì˜ ë°©í–¥ë²¡í„°ì¸ì§€, World Space ìƒì˜ ë°©í–¥ë²¡í„°ì¸ì§€.. ì ì–´ë†”ì•¼ì§€ ì•Œí…ë° ã…¡ã…¡.</p>

<h4 id="1threejs---glsl-shaderì—ì„œ-light-ì‚¬ìš©í•˜ê¸°">1.Three.js - glsl Shaderì—ì„œ Light ì‚¬ìš©í•˜ê¸°</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">uniforms</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">UniformsUtils</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span> <span class="p">[</span>
    <span class="nx">THREE</span><span class="p">.</span><span class="nx">UniformsLib</span><span class="p">[</span> <span class="dl">"</span><span class="s2">lights</span><span class="dl">"</span> <span class="p">]</span>
    <span class="p">]</span> <span class="p">);</span>
  <span class="kd">const</span> <span class="nx">cubeMat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderMaterial</span><span class="p">(</span> <span class="p">{</span>
    <span class="na">uniforms</span><span class="p">:</span> <span class="nx">uniforms</span><span class="p">,</span>
    <span class="na">lights</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">vertexShader</span><span class="p">:</span> <span class="nx">vs</span><span class="p">,</span>
    <span class="na">fragmentShader</span><span class="p">:</span> <span class="nx">fs</span>
    <span class="p">}</span> <span class="p">);</span>
  <span class="kd">const</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cubeGeo</span><span class="p">,</span> <span class="nx">cubeMat</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre></div></div>

<p>ì´ë²ˆì— RimLight + Phong Shading êµ¬í˜„í•˜ë©´ì„œ ì‘ì„±í•œ js ë¶€ë¶„ì…ë‹ˆë‹¤. ë³´ì‹œë©´ <strong>THREE.ShaderMaterial</strong> ë¡œ glsl Shaderë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.<br />
ì´ ë•Œ Sceneì— ì¶”ê°€í•œ Lightì •ë³´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ Three.UniformsUtils.mergeë¡œ Three.jsê°€ ì œê³µí•˜ëŠ” í¬ë§·ì— ë§ëŠ” uniformë“¤ì„ ì„¤ì •í•´ ì¤˜ì•¼í•©ë‹ˆë‹¤.<br />
ë˜í•œ ì´ë¥¼ materialì— ì¶”ê°€í•˜ëŠ” ê²ƒ ë¿ë§Œ ì•„ë‹ˆë¼</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    uniforms: uniforms,
    lights: true,
</code></pre></div></div>
<p>lights: true ë„ ê¼­ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.</p>

<p>ì—¬ê¸°ê¹Œì§€ëŠ” ì‰¬ìš´ë° ê·¸ëŸ¼ glslì—ì„œ uniformìœ¼ë¡œ ì–´ë–»ê²Œ ë°›ì•„ì•¼ í•˜ëŠ”ì§€ê°€ ë¬¸ì œì…ë‹ˆë‹¤.</p>

<p><strong>í‹€ë¦° ì˜ˆì‹œ #1</strong><br />
<a href="https://stackoverflow.com/questions/30151086/threejs-how-do-i-make-a-custom-shader-be-lit-by-the-scenes-lights">https://stackoverflow.com/questions/30151086/threejs-how-do-i-make-a-custom-shader-be-lit-by-the-scenes-lights</a></p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uniform</span> <span class="kt">vec3</span> <span class="n">directionalLightColor</span><span class="p">[</span> <span class="n">MAX_DIR_LIGHTS</span> <span class="p">];</span>
<span class="k">uniform</span> <span class="kt">vec3</span> <span class="n">directionalLightDirection</span><span class="p">[</span> <span class="n">MAX_DIR_LIGHTS</span> <span class="p">];</span>
</code></pre></div></div>
<p>2015ë…„ë„ì—ëŠ” ì´ë ‡ê²Œ í–ˆë‚˜ ë´…ë‹ˆë‹¤. ì´ëŸ¬ë©´ ì•ˆëŒì•„ê°€ìš” ã… </p>

<p><strong>í‹€ë¦° ì˜ˆì‹œ #2</strong><br />
<a href="https://stackoverflow.com/questions/35596705/using-lights-in-three-js-shader">https://stackoverflow.com/questions/35596705/using-lights-in-three-js-shader</a></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if NUM_DIR_LIGHTS &gt; 0
</span>    <span class="k">struct</span> <span class="n">DirectionalLight</span> <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">direction</span><span class="p">;</span>
        <span class="kt">vec3</span> <span class="n">color</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">shadow</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">shadowBias</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">shadowRadius</span><span class="p">;</span>
        <span class="kt">vec2</span> <span class="n">shadowMapSize</span><span class="p">;</span>
     <span class="p">};</span>
     <span class="k">uniform</span> <span class="n">DirectionalLight</span> <span class="n">directionalLights</span><span class="p">[</span> <span class="n">NUM_DIR_LIGHTS</span> <span class="p">];</span>
<span class="cp">#endif
</span></code></pre></div></div>
<p>ì´ê²ƒë„ ì•ˆë©ë‹ˆë‹¤. ìµœì¢… ê²°ê³¼ë‘ ì¡°ê¸ˆ ë¹„ìŠ·í•˜ê¸´ í•œëŒ€, ì•„ë§ˆ ì¶”ê°€ì ì¸ ê¸°ëŠ¥ë“¤ì„ ì‚¬ìš©í•˜ëŠë¼ memberê°€ ëŠ˜ì–´ë‚œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë‹¤ë§Œ ê²°ë¡ ë¶€í„° ë§í•˜ìë©´ <strong>â€˜uniformsâ€™ì— ì „ë‹¬í•œ ê²ƒê³¼ ì •í™•í•˜ê²Œ ë˜‘ê°™ì€ í˜•íƒœê°€ ì•„ë‹ˆë©´ ì—ëŸ¬ ë‚˜ê³  ì•ˆ ê·¸ë ¤ì§‘ë‹ˆë‹¤.</strong></p>

<p><strong>ì •ë‹µ</strong></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if NUM_DIR_LIGHTS &gt; 0
</span>    <span class="k">struct</span> <span class="n">DirectionalLight</span> <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">direction</span><span class="p">;</span>
        <span class="kt">vec3</span> <span class="n">color</span><span class="p">;</span>
     <span class="p">};</span>
     <span class="k">uniform</span> <span class="n">DirectionalLight</span> <span class="n">directionalLights</span><span class="p">[</span> <span class="n">NUM_DIR_LIGHTS</span> <span class="p">];</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>ë‚˜ì¤‘ì— ì´ ê²Œì‹œê¸€ì„ ë³´ì‹¤ ë•ŒëŠ” ë˜ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”. ì •í™•í•˜ê²Œ í•´ê²°í•˜ëŠ” ë°©ë²•ì€ uniformsë¥¼ log ì°ì–´ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">uniforms</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">UniformsUtils</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span> <span class="p">[</span>
    <span class="nx">THREE</span><span class="p">.</span><span class="nx">UniformsLib</span><span class="p">[</span> <span class="dl">"</span><span class="s2">lights</span><span class="dl">"</span> <span class="p">]</span>
    <span class="p">]</span> <span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">uniforms</span><span class="p">)</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre></div></div>

<p><img src="/assets/images/ThreeJS/2021-01-21-RimLightDev/03.png" alt="03" /></p>
<center>('directionalLights' ì•„ë˜ 'direction' ê³¼ 'color')</center>
<p><br />
ì—¬ê¸°ì—ì„œ ì°íˆëŠ” ê²ƒê³¼ ì™„ì „íˆ ë™ì¼í•˜ê²Œ uniform ì„¤ì •í•˜ì‹œë©´ ì˜ ë  ê²ë‹ˆë‹¤.</p>

<h4 id="2phong-shading-êµ¬í˜„-1">2.Phong Shading êµ¬í˜„</h4>

<p>**ì°¸ê³  : ** 
Phong Shading êµ¬í˜„ - <a href="http://www.opengl-tutorial.org/kr/beginners-tutorials/tutorial-8-basic-shading/">http://www.opengl-tutorial.org/kr/beginners-tutorials/tutorial-8-basic-shading/</a><br />
Vertex Shader - <a href="https://github.com/JoeyDeVries/LearnOpenGL/blob/master/src/2.lighting/3.2.materials_exercise1/3.2.materials.vs">https://github.com/JoeyDeVries/LearnOpenGL/blob/master/src/2.lighting/3.2.materials_exercise1/3.2.materials.vs</a><br />
Fragment Shader - <a href="https://github.com/JoeyDeVries/LearnOpenGL/blob/master/src/2.lighting/3.2.materials_exercise1/3.2.materials.fs">https://github.com/JoeyDeVries/LearnOpenGL/blob/master/src/2.lighting/3.2.materials_exercise1/3.2.materials.fs</a></p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">varying</span> <span class="kt">vec3</span> <span class="n">WorldPos</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">ViewPos</span><span class="p">;</span>

<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInWorld</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInView</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">WorldPos</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">modelMatrix</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">));</span>
    <span class="n">ViewPos</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">viewMatrix</span> <span class="o">*</span> <span class="n">modelMatrix</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">));</span>

    <span class="n">NormalInWorld</span> <span class="o">=</span> <span class="kt">mat3</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">)))</span> <span class="o">*</span> <span class="n">normal</span><span class="p">;</span>
    <span class="n">NormalInView</span> <span class="o">=</span> <span class="n">normalMatrix</span> <span class="o">*</span> <span class="n">normal</span><span class="p">;</span> 
    <span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">projectionMatrix</span> <span class="o">*</span> <span class="n">viewMatrix</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">WorldPos</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<center>(vertex shader)</center>
<p><br /></p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if NUM_DIR_LIGHTS &gt; 0
</span>    <span class="k">struct</span> <span class="n">DirectionalLight</span> <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">direction</span><span class="p">;</span>
        <span class="kt">vec3</span> <span class="n">color</span><span class="p">;</span>
     <span class="p">};</span>
     <span class="k">uniform</span> <span class="n">DirectionalLight</span> <span class="n">directionalLights</span><span class="p">[</span> <span class="n">NUM_DIR_LIGHTS</span> <span class="p">];</span>
<span class="cp">#endif
</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">WorldPos</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">ViewPos</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInView</span><span class="p">;</span>
<span class="k">varying</span> <span class="kt">vec3</span> <span class="n">NormalInWorld</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// ambient</span>
    <span class="c1">// vec3 ambient = light.ambient * material.ambient;</span>
  	 
    <span class="kt">vec3</span> <span class="n">normInView</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">NormalInView</span><span class="p">);</span> <span class="c1">// in view space</span>
    <span class="kt">vec3</span> <span class="n">viewDirInViewSpace</span> <span class="o">=</span> <span class="o">-</span><span class="n">normalize</span><span class="p">(</span><span class="n">ViewPos</span><span class="p">);</span>
    <span class="kt">vec3</span> <span class="n">viewDirInWorldSpace</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cameraPosition</span> <span class="o">-</span> <span class="n">WorldPos</span><span class="p">);</span>

    <span class="c1">// diffuse</span>
    <span class="kt">vec3</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_DIR_LIGHTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">lightDir</span> <span class="o">=</span> <span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">nDotL</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normInView</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">diffuse</span> <span class="o">+=</span> <span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span> <span class="o">*</span> <span class="p">(</span><span class="n">nDotL</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// specular</span>
    <span class="kt">vec3</span> <span class="n">specular</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_DIR_LIGHTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">vec3</span> <span class="n">reflectDir</span> <span class="o">=</span> <span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">,</span> <span class="n">normInView</span><span class="p">);</span> 
        <span class="kt">float</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDirInViewSpace</span><span class="p">,</span> <span class="n">reflectDir</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span> <span class="mi">50</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">specular</span> <span class="o">+=</span> <span class="n">directionalLights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span> <span class="o">*</span> <span class="n">spec</span><span class="p">;</span>  
    <span class="p">}</span>
   
    <span class="c1">// Rim Light</span>
    <span class="kt">float</span> <span class="n">vDn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDirInViewSpace</span><span class="p">,</span> <span class="n">normInView</span><span class="p">),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="kt">vec3</span> <span class="n">rim</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">vDn</span><span class="p">));</span>

    <span class="nb">gl_FragColor</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span> <span class="o">+</span> <span class="n">rim</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span> 
</code></pre></div></div>
<center>(fragment shader)</center>
<p><br /></p>

:ET