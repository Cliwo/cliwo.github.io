I"ï<h2 id="urp-custom-shadow-shader-ë„ì „í•˜ê¸°-ë¬¸ì œí¸13">URP Custom Shadow Shader ë„ì „í•˜ê¸°Â : ë¬¸ì œí¸Â (1/3)</h2>

<p><img src="/assets/images/Unity/01/01.png" alt="01" /></p>
<center>(ì™¼ìª½ì´ Custom N dot L Shader ì˜¤ë¥¸ìª½ì´ ê¸°ë³¸ LitÂ Shader)</center>

<p>ì´ ê¸€ì€ URPì—ì„œ Soft Shadowë¥¼ hlsl shader ì½”ë“œë¡œ ë§Œë“¤ì–´ë‚´ëŠ” ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤ (ë§ˆë‘ íŒŒë‹˜ì˜ íŠœí† ë¦¬ì–¼ì„ ë”°ë¼í•˜ë©°). ì‚¬ì‹¤ URPì—ì„œ SoftShadowë¥¼ ì–»ëŠ” ê²ƒì€ ì´ì œ ì„¤ì • í•œë²ˆì´ë©´ ê°€ëŠ¥í•©ë‹ˆë‹¤. Pipeline Assetì—ì„œ Shadows í•­ëª©ì—ì„œ Soft Shadowë¥¼ ì²´í¬í•´ì£¼ë©´ í•œ ë°©ì— í•´ê²°.</p>

<p><img src="/assets/images/Unity/01/02.png" alt="02" /></p>
<center>(Shadows -&gt; Soft Shadowsë¥¼ ì²´í¬í•˜ë©´ Lit Shaderì—ì„œ ì˜ˆìœ Soft Shadowê°€Â ë‚˜ì˜µë‹ˆë‹¤.)</center>

<p>ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì´ ê¸€ì„ ì“°ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ì €ì²˜ëŸ¼ Unity Shader ì— ìµìˆ™í•˜ì§€ ì•Šì€, í•™êµì—ì„œ ê·¸ë˜í”½ìŠ¤ ìˆ˜ì—…ë§Œ ë“¤ì–´ glsl/hlsl shader ì½”ë“œë§Œ ëŒ€ì¶© ì½ì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ ì–´ë–»ê²Œ Shader ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ”ì§€ ê³µìœ í•˜ê³  ì‹¶ì–´ì„œ</li>
  <li>ì—¬ê¸°ì„œ ì ìš©í•´ë³¸ ë¬¸ì œ ì›ì¸ì„ ì°¾ëŠ” ë°©ë²•ì„ ë‹¤ë¥¸ ë¬¸ì œì—ë„ ë˜‘ê°™ì´ ì ìš©í•´ ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ</li>
</ul>

<p>ì´ ì‹œë¦¬ì¦ˆì˜ ëª©ì°¨ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<ol>
  <li>URP Custom Shadow Shader ë„ì „í•˜ê¸°Â : ë¬¸ì œí¸</li>
  <li>URP Custom Shadow Shader ë„ì „í•˜ê¸°Â : ì½”ë“œ ë”°ë¼ê°€ë©° ë¬¸ì œ ì›ì¸ ì°¾ê¸°</li>
  <li>URP Custom Shadow Shader ë„ì „í•˜ê¸°Â : Frame Debugger ë¡œ ë¬¸ì œ ì›ì¸ ì°¾ê¸°</li>
</ol>

<p>ì´ë²ˆ í¸ì¸ URP Custom Shadow Shader ë„ì „í•˜ê¸°Â : ë¬¸ì œí¸ì€ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ë‰©ë‹ˆë‹¤.</p>

<ol>
  <li>ë§ˆë‘ íŒŒë‹˜ íŠœí† ë¦¬ì–¼ ë”°ë¼í•˜ê¸°</li>
  <li>ë¬¸ì œ í™•ì¸í•˜ê¸° (Shadowê°€ ë‚˜ì˜¤ì§€ ì•ŠìŒ)</li>
</ol>

<h2 id="1-ë§ˆë‘ íŒŒë‹˜-íŠœí† ë¦¬ì–¼ë”°ë¼í•˜ê¸°">1. ë§ˆë‘ íŒŒë‹˜ íŠœí† ë¦¬ì–¼Â ë”°ë¼í•˜ê¸°</h2>
<p>ë§ˆë‘ íŒŒ í…Œí¬ë‹ˆì»¬ ì•„íŠ¸ ì—°êµ¬ì†ŒÂ : ë„¤ì´ë²„ ë¸”ë¡œê·¸
<a href="descriptionblog.naver.com">descriptionblog.naver.com</a></p>

<p>ë¨¼ì € ë§ˆë‘ íŒŒë‹˜ì˜ íŠœí† ë¦¬ì–¼ì„ ë”°ë¼í–ˆìŠµë‹ˆë‹¤. ì „ URPì™€ HDRP ì´ì „ì—ë„ Unity Shaderë¥¼ ì§ì ‘ ì‘ì„±í•´ë³¸ì  ì—†ëŠ” ë‰´ë¹„ ì´ê¸°ì— ì¼ë‹¨ ë¬´ì‘ì • íŠœí† ë¦¬ì–¼ë¶€í„° ë”°ë¼í•´ë´¤ìŠµë‹ˆë‹¤.
<img src="/assets/images/Unity/01/03.png" alt="03" /></p>

<p>ì œ ìœ ë‹ˆí‹° ë²„ì „ì€ 2019.3.7f1 ë²„ì „ì…ë‹ˆë‹¤. URPë¥¼ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ Universal Project Template ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤. (URP ë²„ì „ì€ 7.1.8ì…ë‹ˆë‹¤)</p>

<p><img src="/assets/images/Unity/01/04.png" alt="04" />
Project Settingsì— ë³´ë©´ UniversalRP-HighQuality ë¼ëŠ” ì´ë¦„ì˜ Pipeline Assetì´ ì„¤ì •ëœ ê²ƒì´ ë³´ì…ë‹ˆë‹¤.</p>

<p><img src="/assets/images/Unity/01/05.png" alt="05" />
Test Scene í•˜ë‚˜ë¥¼ ë§Œë“¤ê³  Unlit Shaderë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤(ì‚¬ì§„ì—ì„œ URP_Unlitâ€¦) ì™¼ìª½ì— ë³´ì´ëŠ” ë¨¸í‹°ë¦¬ì–¼ì€ ì´ Shaderë¥¼ ì ìš©í•œ ë¨¸í‹°ë¦¬ì–¼ì…ë‹ˆë‹¤.</p>

<pre><code>
Shader "Unlit/URP_Unlit_SoftShadow"
{
    Properties
    {
        _MainTex ("Texture", 2D) = "white" {}
    }
    SubShader
    {
        Tags { 
            "RenderPipeline" = "UniversalPipeline"
            "RenderType"="Opaque" 
            "Queue"="Geometry+0"
        }
        LOD 100

        Pass
        {
            HLSLPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"

            // GPU Instancing
            #pragma multi_compile_instancing
            // make fog work
            #pragma multi_compile_fog

            // Receive Shadow
            #pragma multi_compile _ _MAIN_LIGHT_SHADOWS
            #pragma multi_compile _ _MAIN_LIGHT_SHADOWS_CASCADE
            #pragma multi_compile _ _ADDITIONAL_LIGHTS
            #pragma multi_compile _ _ADDITIONAL_LIGHT_SHADOWS
            #pragma multi_compile _ _SHADOWS_SOFT

            struct appdata
            {
                float4 vertex : POSITION;
                float2 uv : TEXCOORD0;
                float3 normal : NORMAL;
                UNITY_VERTEX_INPUT_INSTANCE_ID
            };

            struct v2f
            {
                float4 vertex : SV_POSITION;
                float2 uv : TEXCOORD0;
                float fogCoord : TEXCOORD1;
                float3 normal : NORMAL;
                float4 shadowCoord : TEXCOORD2;
                UNITY_VERTEX_INPUT_INSTANCE_ID
                UNITY_VERTEX_OUTPUT_STEREO
            };

            CBUFFER_START(UnityPerMaterial)

            TEXTURE2D(_MainTex);
            SAMPLER(sampler_MainTex);
            half4 _MainTex_ST;

            CBUFFER_END

            v2f vert (appdata v)
            {
                v2f o;
                UNITY_SETUP_INSTANCE_ID(v);
                UNITY_TRANSFER_INSTANCE_ID(v, o); 
                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(o); //VR ì„¤ì •

                o.vertex = TransformObjectToHClip(v.vertex.xyz); //MVPë‘ ê°™ìŒ ì´ë¦„ë§Œ ë‹¬ë¼ì§.
                o.uv = TRANSFORM_TEX(v.uv, _MainTex);
                o.normal = TransformObjectToWorldNormal(v.normal); // Normal Transformì€ ë”°ë¡œ í–‰ë ¬ì´ í•„ìš”.
                o.fogCoord = ComputeFogFactor(o.vertex.z);

                VertexPositionInputs vertexInput = GetVertexPositionInputs(v.vertex.xyz);
                o.shadowCoord = GetShadowCoord(vertexInput);
                return o;
            }

            half4 frag (v2f i) : SV_Target
            {
                UNITY_SETUP_INSTANCE_ID(i);
                UNITY_SETUP_STEREO_EYE_INDEX_POST_VERTEX(i);

                Light mainLight = GetMainLight(i.shadowCoord);

                float4 col = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, i.uv);

                float NdotL = saturate(dot(_MainLightPosition.xyz, i.normal)); // NdotLë¡œ ê°„ë‹¨íˆ ë¼ì´íŒ…í•œë‹¤.
                half3 ambient = SampleSH(i.normal);

                col.rgb *= NdotL * _MainLightColor.rgb * mainLight.shadowAttenuation * mainLight.distanceAttenuation + ambient;
                col.rgb = MixFog(col.rgb, i.fogCoord);
                
                return col;
            }
            ENDHLSL
        }
    }
}
</code></pre>

<p>SHADER GRAPH CUSTOM NODE ë¶€ë¶„ ì´ì „ê¹Œì§€ ì™„ë£Œí•œ ê²°ê³¼íŠœí† ë¦¬ì–¼ì—ì„œ Shader Graph Custom Node ì´ì „ê¹Œì§€ ì™„ì„±í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p>

<h2 id="2-ë¬¸ì œ-í™•ì¸í•˜ê¸°">2. ë¬¸ì œ í™•ì¸Â í•˜ê¸°</h2>

<p><img src="/assets/images/Unity/01/06.png" alt="06" /></p>
<center>(N Dot L ë¼ì´íŒ…ì€ ì˜ ë¨¹ì§€ë§Œ ShadowëŠ” ë³´ì´ì§€Â ì•ŠëŠ”ë‹¤.)</center>

<p><img src="/assets/images/Unity/01/07.png" alt="07" /></p>
<center>(ê¸°ëŒ€í•œ ê²°ê³¼Â (ì •ë‹µ))</center>

<p>ì‚¬ì§„ì—ì„œë„ ë³´ì‹¤ ìˆ˜ ìˆë“¯ Sphereì˜ ê·¸ë¦¼ìê°€ Planeì— ë Œë”ë˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤. ì‘ì„±í•œ ì½”ë“œ ë¶€ë¶„ì—ì„œ ë¬¸ì œê°€ ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.
ì—¬ê¸°ê¹Œì§€ ë¬¸ì œ í™•ì¸ì„ ë§ˆì¹˜ê³  ë‹¤ìŒ ë¬¸ì œ ì›ì¸ì„ ì°¾ëŠ” í¸ìœ¼ë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤</p>
:ET